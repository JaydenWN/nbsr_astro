---
import Image from "astro/components/Image.astro";
import rightArrow from "../../assets/icons/right_arrow.svg";
import TestimonialsCard from "./Testimonials_Card.astro";
---

<section id="testimonials">
    <h2 id="testimonials_title">Testimonials</h2>
    <div class="embla">
        <div class="testimonial_cntrl">
            <button class="embla__prev">Prev</button>
            <button class="embla__next">Next</button>
        </div>
        <div class="embla__viewport">
            <div class="embla__container">
                <div class="embla__slide">
                    <TestimonialsCard
                        testimonial="I have had a small repair needed on my car for some time but was hesitant where to go so googled local smash repairers.  After reading the the reviews on this business I was not disappointed.  Rabeen the manager greeted me warmly and on the spot fixed my car making me a coffee while I waited. I will definitely be bringing my cars here for any future repairs and telling anyone I know to do the same."
                        quotee="Allison Browne"
                    />
                </div>
                <div class="embla__slide">

                    <TestimonialsCard
                        testimonial="I recently visited the Northern Beaches Smash Repairs with some minor dinks. Rabeen was quick to help, in fact he stopped everything he was doing & helped me there & then. The service offered at this smash repairers is some of the best Iâ€™ve come across in a service industry. I left with all the issues been fixing to a very high standard. Thanks for helping me & fixing up my car."
                        quotee="Heather Beeken"
                    />
                </div>
                <div class="embla__slide">

                    <TestimonialsCard
                        testimonial="What a fantastic experience. Rebeen and his super helpful team looked after us to fix our broken wing mirror. The staff from reception to repair were so helpful and friendly. I would recommend them to anyone."
                        quotee="Deb G"
                    />
                </div>
                <div class="embla__slide">

                    <TestimonialsCard
                        testimonial="Echoing alot of other happy customers and the rave reviews. Extremely impressed with the customer service and quality of work carried out. Highly recommended."
                        quotee="Julian Mizzi"
                    />
                </div>
                <div class="embla__slide">

                    <TestimonialsCard
                        testimonial="Car that I bought from a dealership had a loose front bumper. Dealer refused to fix it, so I decided to try my luck with Northern Beaches Smash Repairs. They were amazing and offered to fix the bumper for free! Was in and out in less than 10 minutes. I will definitely be coming back to them for future repairs."
                        quotee="Matthew"
                    />
                </div>
                <div class="embla__slide">

                    <TestimonialsCard
                        testimonial="Rabeen and team did fantastic job painting plastic bumpers on my car. Very reasonably priced as well. Would highly recommend."
                        quotee="Alex Jackson"
                    />
                </div>
                <div class="embla__slide">

                    <TestimonialsCard
                        testimonial="What a really great group of people! Even though my job was quite minor, they treated me personally and professionally throughout. The car has come back detailed and looking terrific - red is not an easy colour to match! Trustworthy, honest and professional!"
                        quotee="Gary Prince"
                    />
                </div>

                
            </div>
        </div>
    </div>
    <div id="fake_icons">Slide <Image src={rightArrow} alt="arrow pointing right"></div>
</section>

<style>
    #fake_icons{
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--sm);
        opacity: 0.3;
        margin-top: var(--sm);
    }
    #testimonials{
        padding: var(--lg);
        display: flex;
        flex-direction: column;
        background-color: #fff;
        box-shadow: inset 0 10px 20px -10px rgba(0, 0, 0, 0.103);


    }
    .testimonial_cntrl{
        visibility: hidden;
    }
    #testimonials_title{
        font-size: 2em;
        text-align: center;
    }

    .embla {
        overflow: hidden;
    }
    .embla__container {
        display: flex;
    }
    .embla__slide {
        margin-right: var(--md);
        flex: 0 0 100%;
        min-width: 0;
    }

    @media (width >= 768px){
        #testimonials{
            padding: var(--tb);
        }
        #testimonials_title{
            font-size: 3em;
        }
       
    }
    @media (width >= 1024px){
        #fake_icons{
            visibility: hidden;
        }
        #testimonials{
            padding: var(--lt);
            gap: var(--lt)
        }
        .embla__slide {
            margin-right: var(--md);
            min-width: 0;
        }
        .testimonial_cntrl{
            visibility: visible;
            display: flex;
            justify-content: center;
        }
        .testimonial_cntrl button{
            background-color: transparent;
            border: 0px;
            text-decoration: underline;
            text-underline-offset: 3px;
            text-decoration-color: var(--dark-red);
            font-family: var(--p);
            cursor: pointer;
        }
    }
    @media (width >= 1440px){
        #testimonials{
            padding: var(--dt);
        }
        .embla__slide {
            flex: 0 0 50%;
            min-width: 0;
        }
        .embla{
           position: relative;
        }
        .embla::after{
            content: '';
            height: 100%;
            width: 100%;
            top: 0px;
            left: 0px;
            position: absolute;
            pointer-events: none;
            background: linear-gradient(270deg, rgb(255, 255, 255) 0%, rgba(255, 255, 255, 0) 5%, rgba(255,255,255,0) 95%, rgb(255, 255, 255) 100%);
        }
    }
    @media (width >= 2560px){
        #testimonials{
            padding: var(--fk);
        }
       
    }

</style>
<script>
    import EmblaCarousel from 'embla-carousel'
    import AutoPlay from 'embla-carousel-autoplay'

    const emblaNode = document.querySelector('.embla') as HTMLElement
    const options = { loop: true }

    const viewportNode = emblaNode.querySelector('.embla__viewport')
    const prevButtonNode = emblaNode.querySelector('.embla__prev')
    const nextButtonNode = emblaNode.querySelector('.embla__next')

    if (viewportNode) {
        // Create AutoPlay instance separately
        const autoPlayInstance = AutoPlay()

        // Initialize EmblaCarousel with AutoPlay
        const emblaApi = EmblaCarousel(viewportNode as HTMLElement, options, [autoPlayInstance])

        prevButtonNode?.addEventListener('click', () => {
            emblaApi.scrollPrev();           // Scroll to the previous item
            autoPlayInstance.stop();          // Stop the autoplay instance
        }, false);

        nextButtonNode?.addEventListener('click', () => {
            emblaApi.scrollNext();            // Scroll to the next item
            autoPlayInstance.stop();          // Stop the autoplay instance
        }, false);

        console.log('Embla Carousel initialized:', emblaApi)
    } else {
        console.error('Embla carousel container not found')
    }
</script>